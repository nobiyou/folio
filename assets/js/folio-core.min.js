!function(e,t){"use strict";const n={config:{notificationDuration:3e3,loadingDelay:300,animationDuration:300},init:function(){this.setupGlobalEvents(),this.initNotificationSystem(),this.initLoadingSystem(),this.initEventTracking()},setupGlobalEvents:function(){e.addEventListener("error",(function(e){console.error("Folio Error:",e.error)})),e.addEventListener("unhandledrejection",(function(e){console.error("Folio Promise Rejection:",e.reason)}))},initNotificationSystem:function(){if(!document.getElementById("folio-notifications")){const e=document.createElement("div");e.id="folio-notifications",e.className="folio-notifications-container",e.style.cssText="position:fixed;top:20px;right:20px;z-index:10000;pointer-events:none;",document.body.appendChild(e)}},showNotification:function(e,t="info",o=null,i={}){o=o||this.config.notificationDuration;const s=document.getElementById("folio-notifications");if(!s)return;const r=document.createElement("div"),c="folio-notification-"+Date.now();r.id=c,r.className=`folio-notification folio-notification-${t}`,r.style.cssText=`background:${this.getNotificationColor(t)};color:white;padding:12px 20px;border-radius:8px;margin-bottom:10px;box-shadow:0 4px 12px rgba(0,0,0,0.15);transform:translateX(100%);transition:transform 0.3s ease,opacity 0.3s ease;pointer-events:auto;font-size:14px;font-weight:500;max-width:350px;word-wrap:break-word;position:relative;display:flex;align-items:center;justify-content:space-between;gap:10px;`;const a=this.getNotificationIcon(t);r.innerHTML=`<div style="display:flex;align-items:center;gap:8px;flex:1;"><span style="font-size:16px;">${a}</span><span>${e}</span></div>${!1!==i.closable?'<button class="folio-notification-close" style="background:none;border:none;color:white;font-size:18px;cursor:pointer;padding:0;width:20px;height:20px;display:flex;align-items:center;justify-content:center;">&times;</button>':""}`,s.appendChild(r),setTimeout((()=>{r.style.transform="translateX(0)"}),10);const l=r.querySelector(".folio-notification-close");return l&&l.addEventListener("click",(()=>{this.hideNotification(r)})),o>0&&setTimeout((()=>{this.hideNotification(r)}),o),this.triggerEvent("folio:notification:show",{message:e,type:t,id:c}),r},hideNotification:function(e){e&&e.parentNode&&(e.style.transform="translateX(100%)",e.style.opacity="0",setTimeout((()=>{e.parentNode&&e.parentNode.removeChild(e)}),this.config.animationDuration))},getNotificationColor:function(e){return{success:"#10b981",error:"#ef4444",warning:"#f59e0b",info:"#3b82f6"}[e]||"#3b82f6"},getNotificationIcon:function(e){return{success:"✅",error:"❌",warning:"⚠️",info:"ℹ️"}[e]||"ℹ️"},initLoadingSystem:function(){if(!document.getElementById("folio-loading-styles")){const e=document.createElement("style");e.id="folio-loading-styles",e.textContent=".folio-btn-loading{opacity:0.7;pointer-events:none;position:relative}.folio-btn-loading::after{content:'';position:absolute;top:50%;left:50%;width:16px;height:16px;margin:-8px 0 0 -8px;border:2px solid transparent;border-top:2px solid currentColor;border-radius:50%;animation:folio-spin 1s linear infinite}@keyframes folio-spin{0%{transform:rotate(0deg)}100%{transform:rotate(360deg)}}",document.head.appendChild(e)}},setButtonLoading:function(e,n=!0){const o=t(e);if(n){o.addClass("folio-btn-loading").prop("disabled",!0);const e=o.text();o.data("folio-original-text",e),"加载中..."!==e&&o.text("加载中...")}else{o.removeClass("folio-btn-loading").prop("disabled",!1);const e=o.data("folio-original-text");e&&(o.text(e),o.removeData("folio-original-text"))}},handleUpgradeClick:function(e,t={}){e.preventDefault();const o=n.$(e.currentTarget),i=o.data("level")||t.level||"vip",s=o.attr("href")||t.url||e.folioConfig&&e.folioConfig.urls&&e.folioConfig.urls.upgrade;return s?(n.setButtonLoading(o,!0),n.showNotification(`正在为您跳转到${"svip"===i?"SVIP":"VIP"}会员升级页面...`,"info",2e3),n.trackEvent("upgrade_click",{level:i,source:t.source||"button"}),void setTimeout((()=>{e.ctrlKey||e.metaKey||t.newTab?(e.open(s,"_blank"),n.setButtonLoading(o,!1)):e.location.href=s}),n.config.loadingDelay)):void n.showNotification("升级链接配置错误","error")},handleLoginClick:function(e,t={}){e.preventDefault();const o=n.$(e.currentTarget),i=o.attr("href")||t.url||e.folioConfig&&e.folioConfig.urls&&e.folioConfig.urls.login;return i?(n.setButtonLoading(o,!0),n.showNotification("正在为您跳转到登录页面...","info",1500),n.trackEvent("login_click",{source:t.source||"button"}),!1!==t.saveReturnUrl&&sessionStorage.setItem("folio_return_url",e.location.href),void setTimeout((()=>{e.location.href=i}),n.config.loadingDelay)):void n.showNotification("登录链接配置错误","error")},handleRegisterClick:function(e,t={}){e.preventDefault();const o=n.$(e.currentTarget),i=o.attr("href")||t.url||e.folioConfig&&e.folioConfig.urls&&e.folioConfig.urls.register;return i?(n.setButtonLoading(o,!0),n.trackEvent("register_click",{source:t.source||"button"}),void setTimeout((()=>{e.location.href=i}),200)):void n.showNotification("注册链接配置错误","error")},initEventTracking:function(){this.events=[]},trackEvent:function(t,n={}){const o={name:t,data:n,timestamp:Date.now(),url:e.location.href,userAgent:navigator.userAgent};this.events.push(o),"undefined"!=typeof gtag&&gtag("event",t,n),e.dataLayer&&e.dataLayer.push({event:t,eventData:n}),this.triggerEvent("folio:track",o),e.folioConfig&&e.folioConfig.debug&&console.log("Folio Event Tracked:",o)},getEventHistory:function(){return this.events},debounce:function(e,t,n=!1){let o;return function(...i){const s=()=>{o=null,n||e(...i)},r=n&&!o;clearTimeout(o),o=setTimeout(s,t),r&&e(...i)}},throttle:function(e,t){let n;return function(...o){n||(e.apply(this,o),n=!0,setTimeout((()=>n=!1),t))}},triggerEvent:function(e,t={}){const n=new CustomEvent(e,{detail:t,bubbles:!0,cancelable:!0});document.dispatchEvent(n)},onEvent:function(e,t){document.addEventListener(e,t)},offEvent:function(e,t){document.removeEventListener(e,t)},isInViewport:function(e){const t=e.getBoundingClientRect();return t.top>=0&&t.left>=0&&t.bottom<=(e.innerHeight||document.documentElement.clientHeight)&&t.right<=(e.innerWidth||document.documentElement.clientWidth)},formatPrice:function(e){return e.toString().replace(/\B(?=(\d{3})+(?!\d))/g,",")},calculateDaysLeft:function(e){const t=new Date,n=new Date(e),o=n-t;return Math.max(0,Math.ceil(o/864e5))},copyToClipboard:function(e){return navigator.clipboard?navigator.clipboard.writeText(e).then((()=>(this.showNotification("已复制到剪贴板","success"),!0))).catch((()=>this.fallbackCopyToClipboard(e))):this.fallbackCopyToClipboard(e)},fallbackCopyToClipboard:function(e){const t=document.createElement("textarea");t.value=e,t.style.position="fixed",t.style.left="-999999px",document.body.appendChild(t),t.select();try{return document.execCommand("copy"),this.showNotification("已复制到剪贴板","success"),Promise.resolve(!0)}catch(e){return this.showNotification("复制失败，请手动复制","error"),Promise.resolve(!1)}finally{document.body.removeChild(t)}},ajax:function(e){const n=Object.assign({method:"POST",url:window.folioConfig&&window.folioConfig.ajaxUrl||"/wp-admin/admin-ajax.php",data:{},timeout:1e4,showLoading:!0,showError:!0},e);return window.folioConfig&&window.folioConfig.nonce&&(n.data.nonce=window.folioConfig.nonce),new Promise(((e,o)=>{t.ajax({url:n.url,method:n.method,data:n.data,timeout:n.timeout,beforeSend:function(){n.showLoading&&n.loadingElement&&FolioCore.setButtonLoading(n.loadingElement,!0)},success:function(t){e(t)},error:function(e,t,i){if(n.showError){let o="请求失败";"timeout"===t?o="请求超时，请稍后重试":e.responseJSON&&e.responseJSON.data&&(o=e.responseJSON.data),FolioCore.showNotification(o,"error")}o({xhr:e,status:t,error:i})},complete:function(){n.showLoading&&n.loadingElement&&FolioCore.setButtonLoading(n.loadingElement,!1)}})}))}};t(document).ready((function(){n.init()})),e.FolioCore=n,e.showNotification=n.showNotification.bind(n)}(window,jQuery);