!function(t,n){"use strict";const o={config:{notificationDuration:3e3,loadingDelay:300,animationDuration:300},init:function(){this.setupGlobalEvents(),this.initNotificationSystem(),this.initLoadingSystem(),this.initEventTracking()},setupGlobalEvents:function(){t.addEventListener("error",function(t){console.error("Folio Error:",t.error)}),t.addEventListener("unhandledrejection",function(t){console.error("Folio Promise Rejection:",t.reason)})},initNotificationSystem:function(){if(!document.getElementById("folio-notifications")){const t=document.createElement("div");t.id="folio-notifications",t.className="folio-notifications-container",t.style.cssText="\n                    position: fixed;\n                    top: 20px;\n                    right: 20px;\n                    z-index: 10000;\n                    pointer-events: none;\n                ",document.body.appendChild(t)}},showNotification:function(t,n="info",o=null,e={}){o=o||this.config.notificationDuration;const i=document.getElementById("folio-notifications");if(!i)return;const a=document.createElement("div"),r="folio-notification-"+Date.now();a.id=r,a.className=`folio-notification folio-notification-${n}`,a.style.cssText=`\n                background: ${this.getNotificationColor(n)};\n                color: white;\n                padding: 12px 20px;\n                border-radius: 8px;\n                margin-bottom: 10px;\n                box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);\n                transform: translateX(100%);\n                transition: transform 0.3s ease, opacity 0.3s ease;\n                pointer-events: auto;\n                font-size: 14px;\n                font-weight: 500;\n                max-width: 350px;\n                word-wrap: break-word;\n                position: relative;\n                display: flex;\n                align-items: center;\n                justify-content: space-between;\n                gap: 10px;\n            `;const s=`\n                <div style="display: flex; align-items: center; gap: 8px; flex: 1;">\n                    <span style="font-size: 16px;">${this.getNotificationIcon(n)}</span>\n                    <span>${t}</span>\n                </div>\n                ${!1!==e.closable?'<button class="folio-notification-close" style="background: none; border: none; color: white; font-size: 18px; cursor: pointer; padding: 0; width: 20px; height: 20px; display: flex; align-items: center; justify-content: center;">&times;</button>':""}\n            `;a.innerHTML=s,i.appendChild(a),setTimeout(()=>{a.style.transform="translateX(0)"},10);const c=a.querySelector(".folio-notification-close");return c&&c.addEventListener("click",()=>{this.hideNotification(a)}),o>0&&setTimeout(()=>{this.hideNotification(a)},o),this.triggerEvent("folio:notification:show",{message:t,type:n,id:r}),a},hideNotification:function(t){t&&t.parentNode&&(t.style.transform="translateX(100%)",t.style.opacity="0",setTimeout(()=>{t.parentNode&&t.parentNode.removeChild(t)},this.config.animationDuration))},getNotificationColor:function(t){const n={success:"#10b981",error:"#ef4444",warning:"#f59e0b",info:"#3b82f6"};return n[t]||n.info},getNotificationIcon:function(t){const n={success:"✅",error:"❌",warning:"⚠️",info:"ℹ️"};return n[t]||n.info},initLoadingSystem:function(){if(!document.getElementById("folio-loading-styles")){const t=document.createElement("style");t.id="folio-loading-styles",t.textContent="\n                    .folio-btn-loading {\n                        opacity: 0.7;\n                        pointer-events: none;\n                        position: relative;\n                    }\n                    \n                    .folio-btn-loading::after {\n                        content: '';\n                        position: absolute;\n                        top: 50%;\n                        left: 50%;\n                        width: 16px;\n                        height: 16px;\n                        margin: -8px 0 0 -8px;\n                        border: 2px solid transparent;\n                        border-top: 2px solid currentColor;\n                        border-radius: 50%;\n                        animation: folio-spin 1s linear infinite;\n                    }\n                    \n                    @keyframes folio-spin {\n                        0% { transform: rotate(0deg); }\n                        100% { transform: rotate(360deg); }\n                    }\n                ",document.head.appendChild(t)}},setButtonLoading:function(t,o=!0){const e=n(t);if(o){e.addClass("folio-btn-loading").prop("disabled",!0);const t=e.text();e.data("folio-original-text",t),"加载中..."!==t&&e.text("加载中...")}else{e.removeClass("folio-btn-loading").prop("disabled",!1);const t=e.data("folio-original-text");t&&(e.text(t),e.removeData("folio-original-text"))}},handleUpgradeClick:function(e,i={}){e.preventDefault();const a=n(e.currentTarget),r=a.data("level")||i.level||"vip",s=a.attr("href")||i.url||t.folioConfig&&t.folioConfig.urls&&t.folioConfig.urls.upgrade;if(!s)return void o.showNotification("升级链接配置错误","error");o.setButtonLoading(a,!0);const c="svip"===r?"SVIP":"VIP";o.showNotification(`正在为您跳转到${c}会员升级页面...`,"info",2e3),o.trackEvent("upgrade_click",{level:r,source:i.source||"button"}),setTimeout(()=>{e.ctrlKey||e.metaKey||i.newTab?(t.open(s,"_blank"),o.setButtonLoading(a,!1)):t.location.href=s},o.config.loadingDelay)},handleLoginClick:function(e,i={}){e.preventDefault();const a=n(e.currentTarget),r=a.attr("href")||i.url||t.folioConfig&&t.folioConfig.urls&&t.folioConfig.urls.login;r?(o.setButtonLoading(a,!0),o.showNotification("正在为您跳转到登录页面...","info",1500),o.trackEvent("login_click",{source:i.source||"button"}),!1!==i.saveReturnUrl&&sessionStorage.setItem("folio_return_url",t.location.href),setTimeout(()=>{t.location.href=r},o.config.loadingDelay)):o.showNotification("登录链接配置错误","error")},handleRegisterClick:function(e,i={}){e.preventDefault();const a=n(e.currentTarget),r=a.attr("href")||i.url||t.folioConfig&&t.folioConfig.urls&&t.folioConfig.urls.register;r?(o.setButtonLoading(a,!0),o.trackEvent("register_click",{source:i.source||"button"}),setTimeout(()=>{t.location.href=r},200)):o.showNotification("注册链接配置错误","error")},initEventTracking:function(){this.events=[]},trackEvent:function(n,o={}){const e={name:n,data:o,timestamp:Date.now(),url:t.location.href,userAgent:navigator.userAgent};this.events.push(e),"undefined"!=typeof gtag&&gtag("event",n,o),t.dataLayer&&t.dataLayer.push({event:n,eventData:o}),this.triggerEvent("folio:track",e),t.folioConfig&&t.folioConfig.debug&&console.log("Folio Event Tracked:",e)},getEventHistory:function(){return this.events},debounce:function(t,n,o=!1){let e;return function(...i){const a=o&&!e;clearTimeout(e),e=setTimeout(()=>{e=null,o||t(...i)},n),a&&t(...i)}},throttle:function(t,n){let o;return function(...e){o||(t.apply(this,e),o=!0,setTimeout(()=>o=!1,n))}},triggerEvent:function(t,n={}){const o=new CustomEvent(t,{detail:n,bubbles:!0,cancelable:!0});document.dispatchEvent(o)},onEvent:function(t,n){document.addEventListener(t,n)},offEvent:function(t,n){document.removeEventListener(t,n)},isInViewport:function(n){const o=n.getBoundingClientRect();return o.top>=0&&o.left>=0&&o.bottom<=(t.innerHeight||document.documentElement.clientHeight)&&o.right<=(t.innerWidth||document.documentElement.clientWidth)},formatPrice:function(t){return t.toString().replace(/\B(?=(\d{3})+(?!\d))/g,",")},calculateDaysLeft:function(t){const n=new Date,o=new Date(t)-n,e=Math.ceil(o/864e5);return Math.max(0,e)},copyToClipboard:function(t){return navigator.clipboard?navigator.clipboard.writeText(t).then(()=>(this.showNotification("已复制到剪贴板","success"),!0)).catch(()=>this.fallbackCopyToClipboard(t)):this.fallbackCopyToClipboard(t)},fallbackCopyToClipboard:function(t){const n=document.createElement("textarea");n.value=t,n.style.position="fixed",n.style.left="-999999px",document.body.appendChild(n),n.select();try{return document.execCommand("copy"),this.showNotification("已复制到剪贴板","success"),Promise.resolve(!0)}catch(t){return this.showNotification("复制失败，请手动复制","error"),Promise.resolve(!1)}finally{document.body.removeChild(n)}},ajax:function(e){const i={method:"POST",url:t.folioConfig&&t.folioConfig.ajaxUrl||"/wp-admin/admin-ajax.php",data:{},timeout:1e4,showLoading:!0,showError:!0,nonceMode:"none",nonceField:"nonce",nonceValue:null},a=Object.assign({},i,e),r=a.nonceField||"nonce",s="string"==typeof a.nonceValue?a.nonceValue:"",c=t.folioConfig&&"string"==typeof t.folioConfig.nonce?t.folioConfig.nonce:"",l=""!==s?s:"auto"===a.nonceMode?c:"";return""!==l&&(a.data instanceof FormData?a.data.has(r)||a.data.append(r,l):a.data&&"object"==typeof a.data&&void 0===a.data[r]&&(a.data[r]=l)),new Promise((t,e)=>{n.ajax({url:a.url,method:a.method,data:a.data,timeout:a.timeout,beforeSend:function(){a.showLoading&&a.loadingElement&&o.setButtonLoading(a.loadingElement,!0)},success:function(n){t(n)},error:function(t,n,i){if(a.showError){let e="请求失败";"timeout"===n?e="请求超时，请稍后重试":t.responseJSON&&t.responseJSON.data&&(e=t.responseJSON.data),o.showNotification(e,"error")}e({xhr:t,status:n,error:i})},complete:function(){a.showLoading&&a.loadingElement&&o.setButtonLoading(a.loadingElement,!1)}})})}};n(document).ready(function(){o.init()}),t.FolioCore=o,t.showNotification=o.showNotification.bind(o)}(window,jQuery);